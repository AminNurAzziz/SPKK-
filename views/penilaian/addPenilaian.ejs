<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Penilaian</title>
    <!-- Include Bootstrap CSS -->
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="mb-4">Form Penilaian</h1>
      <form action="/penilaian/new" method="POST">
        <!-- Input Pegawai ID (Assuming you have a list of employees to choose from) -->
        <div class="form-group">
          <label for="pegawaiID">Pegawai:</label>
          <select class="form-control" name="pegawaiID" id="pegawaiID" required>
            <% for (const employee of pegawai) { %>
            <option value="<%= employee._id %>">
              <%= employee.namaPegawai %>
            </option>
            <% } %>
          </select>
        </div>
        <!-- Menampilkan Jabatan Otomatis -->
        <div class="form-group">
          <label for="jabatan">Jabatan:</label>
          <input
            type="text"
            class="form-control"
            name="jabatan"
            id="jabatan"
            value="<%= pegawai[0].jabatanID.namaJabatan %>"
            readonly
          />
        </div>
        <!-- Input Tanggal -->
        <div class="form-group">
          <label for="tanggal">Tanggal:</label>
          <input
            type="date"
            class="form-control"
            name="tanggal"
            id="tanggal"
            required
          />
        </div>

        <!-- Input Bulan Penilaian -->
        <div class="form-group">
          <label for="bulanPenilaian">Bulan Penilaian:</label>
          <select
            class="form-control"
            name="bulanPenilaian"
            id="bulanPenilaian"
            required
          >
            <option value="Januari">Januari</option>
            <option value="Februari">Februari</option>
            <option value="Maret">Maret</option>
            <option value="April">April</option>
            <option value="Mei">Mei</option>
            <option value="Juni">Juni</option>
            <option value="Juli">Juli</option>
            <option value="Agustus">Agustus</option>
            <option value="September">September</option>
            <option value="Oktober">Oktober</option>
            <option value="November">November</option>
            <option value="Desember">Desember</option>
          </select>
        </div>

        <!-- Input Izin -->
        <div class="form-group">
          <label for="izin">Izin:</label>
          <input
            type="number"
            class="form-control"
            name="izin"
            id="izin"
            required
          />
        </div>

        <!-- Input Tanpa Izin -->
        <div class="form-group">
          <label for="tanpaIzin">Tanpa Izin:</label>
          <input
            type="number"
            class="form-control"
            name="tanpaIzin"
            id="tanpaIzin"
            required
          />
        </div>

        <!-- Detail Penilaian -->
        <h2 class="mt-4">Detail Penilaian</h2>
        <button
          type="button"
          class="btn btn-primary mb-2"
          data-toggle="modal"
          data-target="#addCategoryModal"
        >
          Add Category
        </button>

        <div id="detail_penilaian">
          <table class="table">
            <thead>
              <tr>
                <th>NO</th>
                <th>Keterangan</th>
                <th>Nilai</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% for (let i = 0; i < kategori.length; i++) { %>
              <tr>
                <td><%= i + 1 %></td>
                <td><%= kategori[i].name %></td>
                <td>
                  <% const values = ['SB', 'B', 'C', 'K', 'SK']; %> <% for (let
                  j = 0; j < values.length; j++) { %>
                  <div class="form-check form-check-inline">
                    <input
                      type="radio"
                      class="form-check-input"
                      name="kategori<%= i %>"
                      value="<%= values[j] %>"
                      id="kategori<%= i %>_<%= values[j] %>"
                    />
                    <label
                      class="form-check-label"
                      for="kategori<%= i %>_<%= values[j] %>"
                    >
                      <%= values[j] %>
                    </label>
                  </div>
                  <% } %>
                </td>
                <td>
                  <button
                    type="button"
                    class="btn btn-danger"
                    onclick="deleteCategory('<%= kategori[i]._id %>')"
                  >
                    Delete
                  </button>
                </td>
              </tr>

              <!-- Input tersembunyi untuk kategori ID -->
              <input
                type="hidden"
                name="kategori<%= i %>_id"
                value="<%= kategori[i]._id %>"
              />
              <% } %>
            </tbody>
          </table>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>

    <!-- Modal untuk Add Category -->
    <div
      class="modal fade"
      id="addCategoryModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Add Category</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form action="/category/new" method="POST">
              <div class="form-group">
                <label for="name">Category</label>
                <input type="text" class="form-control" id="name" name="name" />
              </div>
              <button type="submit" class="btn btn-primary">Submit</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      const pegawaiSelect = document.getElementById("pegawaiID");
      const jabatanInput = document.getElementById("jabatan");
      const pegawaiData = <%- JSON.stringify(pegawai) %>;

      // Tambahkan event listener untuk perubahan dalam elemen select
      pegawaiSelect.addEventListener("change", () => {
          // Dapatkan pegawai yang dipilih
          const selectedOption = pegawaiSelect.options[pegawaiSelect.selectedIndex];
          // Dapatkan id pegawai dari elemen option yang dipilih
          const selectedPegawaiId = selectedOption.value;

          // Cari pegawai yang sesuai dengan id yang dipilih dalam data pegawai
          const selectedPegawai = pegawaiData.find((pegawai) => pegawai._id === selectedPegawaiId);

          if (selectedPegawai) {
              // Dapatkan jabatan dari objek pegawai yang dipilih
              const jabatan = selectedPegawai.jabatanID.namaJabatan;
              // Set nilai jabatanInput sesuai dengan jabatan yang ditemukan
              jabatanInput.value = jabatan;
              console.log(jabatan);
          }
      });
    </script>
    <!-- Tambahkan kode berikut di dalam elemen <script> Anda -->
    <script>
      function deleteCategory(categoryId) {
        console.log(categoryId);
        // Konfirmasi pengguna sebelum menghapus
        if (confirm("Anda yakin ingin menghapus kategori ini?")) {
          // Buat objek permintaan XMLHttpRequest
          var xhr = new XMLHttpRequest();

          // Tentukan metode dan URL permintaan
          xhr.open(
            "POST",
            `/category/delete/${categoryId}?_method=DELETE`,
            true
          );

          // Atur penanganan respons permintaan
          xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                // Sukses, lakukan tindakan yang diperlukan
                alert("Kategori berhasil dihapus.");
                // Contoh: Memuat ulang halaman setelah penghapusan kategori
                window.location.reload();
              } else {
                // Ada kesalahan dalam permintaan, tampilkan pesan kesalahan
                alert("Terjadi kesalahan saat menghapus kategori.");
              }
            }
          };

          // Kirim permintaan
          xhr.send();
        }
      }
    </script>

    <!-- Include Bootstrap JS (optional) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
